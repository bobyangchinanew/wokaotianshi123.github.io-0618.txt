<!DOCTYPE html>
<html>
<head>
<title>CKPlayer 播放最快的 M3U8 视频流</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- 引入 CKPlayer 的 CSS -->
<link href="https://vjs.zencdn.net/7.10.4/video-js.css" rel="stylesheet" />

<style>
  #video-container {
    width: 100%;
    max-width: 800px; /* 根据需要调整 */
    margin: 20px auto; /* 留出一些边距 */
  }
</style>
</head>
<body>
<div id="video-container">
  <!-- CKPlayer 播放器将被动态插入这里 -->
</div>
<script src="https://vjs.zencdn.net/7.10.4/video.js"></script>
<script>
var apiArray = [
    "https://www.ckplayer.vip/jiexi/?url=",
    "https://jx.jsonplayer.com/player/?url=",
    "https://jx.m3u8.tv/jiexi/?url=",
    "https://jx.xmflv.com/?url=",
    "https://www.8090g.cn/jiexi/?url="
];

var origin = decodeURIComponent(document.location.href.split("url=")[1]);
var videoContainer = document.getElementById("video-container");
var fastestUrl = "";
var fastestTime = Infinity;

function checkUrl(url) {
    return new Promise((resolve, reject) => {
        var script = document.createElement("script");
        script.src = url + "&callback=loadScript";
        script.onload = () => resolve(url);
        script.onerror = () => reject(url);
        document.head.appendChild(script);
    });
}

function loadFastestVideo() {
    apiArray.reduce((promise, api) => {
        return promise.then(() => checkUrl(api + origin))
            .then((url) => {
                if (!fastestUrl || (performance.now() - startTime < fastestTime)) {
                    fastestUrl = url;
                    fastestTime = performance.now() - startTime;
                }
                return new Promise((resolve) => setTimeout(resolve, 1000)); // 等待1秒
            });
    }, Promise.resolve())
    .then(() => {
        if (fastestUrl) {
            createCkplayer(fastestUrl);
        } else {
            console.error("No valid video source found.");
        }
    });
}

function createCkplayer(url) {
    var ckplayer = new CKPlayer({
        container: '#video-container', // 指定播放器容器
        url: url, // 设置视频流URL
        autoplay: false, // 是否自动播放
        controls: true, // 是否显示控制栏
        // 其他CKPlayer配置项...
    });
}

// 页面加载完成后开始加载最快的视频
document.addEventListener("DOMContentLoaded", (event) => {
    var startTime = performance.now();
    loadFastestVideo();
});
</script>
</body>
</html>

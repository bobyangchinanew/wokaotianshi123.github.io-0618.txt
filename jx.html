<!DOCTYPE html>
<html>
<head>
<title>Video.js 播放最快的 M3U8 视频流</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- 引入 Video.js 的 CSS -->
<link href="https://vjs.zencdn.net/7.10.4/video-js.css" rel="stylesheet" />

<style>
  #video-container {
    width: 100%;
    max-width: 800px; /* 根据需要调整 */
    margin: 20px auto; /* 留出一些边距 */
  }
</style>
</head>
<body>
<div id="video-container">
  <!-- Video.js 播放器将被动态插入这里 -->
  <video id="video-player" class="video-js" controls preload="auto" width="640" height="360" data-setup='{}'></video>
</div>

<!-- 引入 Video.js 的 JavaScript -->
<script src="https://vjs.zencdn.net/7.10.4/video.js"></script>

<script>
var apiArray = [
    "https://www.ckplayer.vip/jiexi/?url=",
    "https://jx.jsonplayer.com/player/?url=",
    "https://jx.m3u8.tv/jiexi/?url=",
    "https://jx.xmflv.com/?url=",
    "https://www.8090g.cn/jiexi/?url="
];

var origin = decodeURIComponent(document.location.href.split("url=")[1]);
var videoContainer = document.getElementById("video-container");
var videoPlayer = document.getElementById("video-player");
var fastestUrl = null;
var fastestTime = Infinity;

function checkUrl(url) {
    return new Promise((resolve, reject) => {
        var script = document.createElement("script");
        script.src = url + "&callback=loadScript";
        script.onload = () => resolve(url);
        script.onerror = () => reject(url);
        document.head.appendChild(script);
    });
}

function loadFastestVideo() {
    var promises = apiArray.map(api => {
        return checkUrl(api + origin).then(url => {
            var time = performance.now();
            if (fastestTime > (time - startTime)) {
                fastestTime = time - startTime;
                fastestUrl = url;
            }
        });
    });
    Promise.all(promises).then(() => {
        if (fastestUrl) {
            videoPlayer.src("m3u8", fastestUrl);
        } else {
            console.error("No valid video source found.");
        }
    });
}

// 页面加载完成后开始加载最快的视频
document.addEventListener("DOMContentLoaded", (event) => {
    var startTime = performance.now();
    loadFastestVideo();
});
</script>
</body>
</html>
